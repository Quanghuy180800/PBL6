{"ast":null,"code":"var _jsxFileName = \"/home/phuocnghia712/Desktop/CSHTTT/client/src/components/mainpages/createProduct/UploadImg.js\";\nimport React, { useState, useContext, useEffect } from 'react';\nimport { GlobalState } from '../../../GlobalState';\nimport axios from 'axios';\nimport Loading from '../utils/loading/Loading';\nimport { useHistory, useParams } from 'react-router';\n\nfunction UploadImg() {\n  const state = useContext(GlobalState);\n  const [images, setImages] = useState(false);\n  const [isAdmin] = state.userAPI.isAdmin;\n  const [done, setDone] = state.productsAPI.done;\n  const [token] = state.token;\n  const [loading, setLoading] = useState(false);\n  const param = useParams();\n  const history = useHistory();\n  console.log(done);\n  const styleUpload = {\n    display: images ? \"block\" : \"none\"\n  };\n\n  const handleDestroy = async () => {\n    try {\n      if (!isAdmin) return alert(\"You're not an admin\");\n      setLoading(true);\n      await axios.post('/api/destroy', {\n        public_id: images.public_id\n      }, {\n        headers: {\n          Authorization: token\n        }\n      });\n      setLoading(false);\n      setImages(false);\n    } catch (err) {\n      alert(err.response.data.msg);\n    }\n  };\n\n  const handleUpload = async e => {\n    e.preventDefault();\n\n    try {\n      if (!isAdmin) return alert(\"You're not an admin\");\n      /* const file = e.target.files[0]\n           if(!file) return alert(\"File not exist.\")\n        if(file.size > 1024 * 1024) // 1mb\n           return alert(\"Size too large!\")\n        if(file.type !== 'image/jpeg' && file.type !== 'image/png') // 1mb\n           return alert(\"File format is incorrect.\")\n        let formData = new FormData()\n       formData.append('file', file)\n        setLoading(true)\n       const res = await axios.post('/api/upload', formData, {\n           headers: {'content-type': 'multipart/form-data', Authorization: token}\n       })\n       setLoading(false)*/\n      //setImages(res.data)\n\n      const files = e.target.files; //  console.log(files)\n\n      var i = 0;\n      let formData = new FormData();\n\n      for (i; i < files.length; i++) {\n        formData.append('files', files[i]);\n      }\n\n      setLoading(true);\n      const res = await axios.post(`/api/upload/${param.id}`, formData, {\n        headers: {\n          'content-type': 'multipart/form-data',\n          Authorization: token\n        }\n      });\n      setLoading(false); // setImages(res.data.data[0])\n      //console.log(res.data.data)\n\n      setDone(true);\n      console.log(done); //history.push('/product')\n\n      /*  for ( i; i<files.length;i++){\n        console.log(i)    \n        if(!files[i]) return alert(\"File not exist.\")\n         if(files[i].size > 1024 * 1024) // 1mb\n            return alert(files[i].name+\" \"+\"Size too large!\")\n             console.log(files[i].type)\n        if(files[i].type !== 'image/jpeg' && files[i].type !== 'image/png') // 1mb\n            return alert(i+\" \"+\"File format is incorrect.\")\n         let formData = new FormData()\n        formData.append('file', files[i])\n         setLoading(true)\n        const res = await axios.post('/api/upload', formData, {\n            headers: {'content-type': 'multipart/form-data', Authorization: token}\n        })\n        setLoading(false)\n        setImages(res.data)\n       console.log(res.data.url)\n      }*/\n    } catch (err) {// alert(err.response.data.msg)\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"upload\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 12\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"file\",\n    name: \"files\",\n    id: \"files\",\n    onChange: handleUpload,\n    multiple: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 13\n    }\n  }), loading ? /*#__PURE__*/React.createElement(\"div\", {\n    id: \"file_img\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 27\n    }\n  }, /*#__PURE__*/React.createElement(Loading, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 46\n    }\n  })) : /*#__PURE__*/React.createElement(\"div\", {\n    id: \"file_img\",\n    style: styleUpload,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 18\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 21\n    }\n  }, \"OK\"), /*#__PURE__*/React.createElement(\"span\", {\n    onClick: handleDestroy,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 21\n    }\n  }, \"X\"))));\n}\n\nexport default UploadImg;","map":{"version":3,"sources":["/home/phuocnghia712/Desktop/CSHTTT/client/src/components/mainpages/createProduct/UploadImg.js"],"names":["React","useState","useContext","useEffect","GlobalState","axios","Loading","useHistory","useParams","UploadImg","state","images","setImages","isAdmin","userAPI","done","setDone","productsAPI","token","loading","setLoading","param","history","console","log","styleUpload","display","handleDestroy","alert","post","public_id","headers","Authorization","err","response","data","msg","handleUpload","e","preventDefault","files","target","i","formData","FormData","length","append","res","id"],"mappings":"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","sourcesContent":["import React, {useState, useContext, useEffect} from 'react'\nimport { GlobalState } from '../../../GlobalState'\nimport axios from 'axios'\nimport Loading from '../utils/loading/Loading'\nimport { useHistory, useParams } from 'react-router'\n\nfunction UploadImg() {\n    const state = useContext(GlobalState)\n    const [images, setImages] = useState(false)\n    const [isAdmin] = state.userAPI.isAdmin\n    const   [done,setDone] = state.productsAPI.done\n    const [token] = state.token\n    const [loading, setLoading] = useState(false)\n    const param = useParams()\n    const history = useHistory()\n    console.log(done)\n    const styleUpload = {\n        display: images ? \"block\" : \"none\"\n    }\n    const handleDestroy = async () => {\n        try {\n            if(!isAdmin) return alert(\"You're not an admin\")\n            setLoading(true)\n            await axios.post('/api/destroy', {public_id: images.public_id}, {\n                headers: {Authorization: token}\n            })\n            setLoading(false)\n            setImages(false)\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n    const handleUpload = async e =>{\n        e.preventDefault()\n        try {\n            if(!isAdmin) return alert(\"You're not an admin\")\n           \n           /* const file = e.target.files[0]\n                if(!file) return alert(\"File not exist.\")\n\n            if(file.size > 1024 * 1024) // 1mb\n                return alert(\"Size too large!\")\n\n            if(file.type !== 'image/jpeg' && file.type !== 'image/png') // 1mb\n                return alert(\"File format is incorrect.\")\n\n            let formData = new FormData()\n            formData.append('file', file)\n\n            setLoading(true)\n            const res = await axios.post('/api/upload', formData, {\n                headers: {'content-type': 'multipart/form-data', Authorization: token}\n            })\n            setLoading(false)*/\n\n        //setImages(res.data)\n            const files = e.target.files\n          //  console.log(files)\n            var i=0;\n            let formData = new FormData()\n            \n            for (i; i<files.length;i++){\n                formData.append('files', files[i])\n            }\n            setLoading(true)\n            const res = await axios.post(`/api/upload/${param.id}`, formData, {\n                headers: {'content-type': 'multipart/form-data', Authorization: token}\n            })\n           \n            setLoading(false)\n           // setImages(res.data.data[0])\n            //console.log(res.data.data)\n            setDone(true)\n            console.log(done)\n             //history.push('/product')\n          /*  for ( i; i<files.length;i++){\n            console.log(i)    \n            if(!files[i]) return alert(\"File not exist.\")\n\n            if(files[i].size > 1024 * 1024) // 1mb\n                return alert(files[i].name+\" \"+\"Size too large!\")\n\n                console.log(files[i].type)\n            if(files[i].type !== 'image/jpeg' && files[i].type !== 'image/png') // 1mb\n                return alert(i+\" \"+\"File format is incorrect.\")\n\n            let formData = new FormData()\n            formData.append('file', files[i])\n\n            setLoading(true)\n            const res = await axios.post('/api/upload', formData, {\n                headers: {'content-type': 'multipart/form-data', Authorization: token}\n            })\n            setLoading(false)\n            setImages(res.data)\n           console.log(res.data.url)\n        }*/\n\n        \n\n        } catch (err) {\n           // alert(err.response.data.msg)\n        }\n    }\n\n    return(\n        <>\n           <div className=\"upload\">\n            <input type=\"file\" name=\"files\" id=\"files\" onChange={handleUpload} multiple/>\n            {\n                loading ? <div id=\"file_img\"><Loading /></div>\n\n                :<div id=\"file_img\" style={styleUpload}>\n                    <p>OK</p>\n                    <span onClick={handleDestroy}>X</span>\n                </div>\n            }\n            \n        </div>\n        </>\n    )\n}\n\nexport default UploadImg;"]},"metadata":{},"sourceType":"module"}